# ğŸ“š 14ì¥ ì½”ë£¨í‹´

## ğŸ“– 14.1 ë™ì‹œì„±ê³¼ ë³‘ë ¬ì„±

- ë™ì‹œì„±
    - ì—¬ëŸ¬ ì‘ì—…ì„ ë™ì‹œì— ì‹¤í–‰í•˜ëŠ” ê²ƒ
    - CPU ì½”ì–´ í•˜ë‚˜ì—ì„œ ë™ì‹œì„± ì‚¬ìš© ê°€ëŠ¥
- ë³‘ë ¬ì„±
    - ì½”ë“œë¥¼ ì—¬ëŸ¬ ë¶€ë¶„ìœ¼ë¡œ ë‚˜ëˆ ì„œ ë™ì‹œì— ìˆ˜í–‰í•  ìˆ˜ ìˆëŠ” ëŠ¥ë ¥
    - ì—¬ëŸ¬ CPU ì½”ì–´ì—ì„œ ë¬¼ë¦¬ì ìœ¼ë¡œ ë™ì‹œì— ì‹¤í–‰í•˜ëŠ” ê²ƒ

## ğŸ“– 14.2 ì½”í‹€ë¦°ì˜ ë™ì‹œì„± ì²˜ë¦¬ ë°©ë²•: ì¼ì‹œ ì¤‘ë‹¨ í•¨ìˆ˜ì™€ ì½”ë£¨í‹´

- ì½”ë£¨í‹´ì€ ë¹„ë™ê¸°ì ìœ¼ë¡œ ì‹¤í–‰ë˜ëŠ” ë„Œë¸”ë¡œí‚¹ ë™ì‹œì„± ì½”ë“œë¥¼ ìš°ì•„í•˜ê²Œ ì‘ì„±í•  ìˆ˜ ìˆê²Œ í•´ì¤€ë‹¤.
- ìŠ¤ë ˆë“œì— ë¹„í•´ ë§¤ìš° ê°€ë³ë‹¤.
- ë™ì‹œì„± ì‘ì—…ê³¼ ìƒëª…ì£¼ê¸° ê´€ë¦¬ ê¸°ëŠ¥ ì œê³µ

## ğŸ“– 14.3 ìŠ¤ë ˆë“œì™€ ì½”ë£¨í‹´ ë¹„êµ

- JVMì—ì„œ ë³‘ë ¬ í”„ë¡œê·¸ë˜ë°ê³¼ ë™ì‹œì„± í”„ë¡œê·¸ë˜ë°ì„ ìœ„í•œ ê³ ì „ì ì¸ ì¶”ìƒí™”ëŠ” ìŠ¤ë ˆë“œë¥¼ ì‚¬ìš©í•˜ëŠ”

```kotlin
fun main() {
    println("I'm on ${Thread.currentThread().name}")
    thread {
        println("And I'm on ${Thread.currentThread().name}")
    }
}
```

- ìŠ¤ë ˆë“œëŠ” ì• í”Œë¦¬ì¼€ì´ì…˜ì„ ë” ë°˜ì‘ì„± ìˆê²Œ ë§Œë“¤ì–´ì£¼ê³ , ë©€í‹°ì½”ì–´ CPUì˜ ì—¬ëŸ¬ ì½”ì–´ì— ì‘ì—…ì„ ë¶„ì‚°ì‹œì¼œ í˜„ëŒ€ì  ì‹œìŠ¤í…œì„ ë” íš¨ìœ¨ì ìœ¼ë¡œ ì‚¬ìš©í•  ìˆ˜ ìˆê²Œ í•´ì¤€ë‹¤.
- ìŠ¤ë ˆë“œ ê°„ ì „í™˜ì€ ìš´ì˜ì²´ì œ ì»¤ë„ ìˆ˜ì¤€ì—ì„œ ì‹¤í–‰ë˜ëŠ” ì‘ì—…
- ìŠ¤ë ˆë“œê°€ ì–´ë–¤ ì‘ì—…ì´ ì™„ë£Œë˜ê¸¸ ê¸°ë‹¤ë¦¬ëŠ” ë™ì•ˆì—ëŠ” ë¸”ë¡ëœë‹¤.
- ìŠ¤ë ˆë“œëŠ” ê¸°ë³¸ì ìœ¼ë¡œ ë…ë¦½ì ì¸ í”„ë¡œì„¸ìŠ¤ë¡œ ì¡´ì¬í•˜ê¸° ë•Œë¬¸ì— ì‘ì—…ì„ ê´€ë¦¬í•˜ê³  ì¡°ì •í•˜ëŠ” ë° ì–´ë ¤ì›€ì´ ìˆì„ ìˆ˜ ìˆë‹¤.

ì½”í‹€ë¦°ì€ ìŠ¤ë ˆë“œì— ëŒ€í•œ ëŒ€ì•ˆìœ¼ë¡œ ì½”ë£¨í‹´ì´ë¼ëŠ” ì¶”ìƒí™”ë¥¼ ë„ì…

- ì½”ë£¨í‹´ì€ ì´ˆê²½ëŸ‰ ì¶”ìƒí™”ë‹¤.
- ì½”ë£¨í‹´ì€ ì‹œìŠ¤í…œ ìì›ì„ ë¸”ë¡ì‹œí‚¤ì§€ ì•Šê³  ì‹¤í–‰ì„ ì¼ì‹œ ì¤‘ë‹¨í•  ìˆ˜ ìˆìœ¼ë©°, ì¤‘ë‹¨ ì§€ì ì—ì„œ ì¬ê°œí•  ìˆ˜ ìˆë‹¤.
- ì½”ë£¨í‹´ì€ êµ¬ì¡°í™”ëœ ë™ì‹œì„±ì´ë¼ëŠ” ê°œë…ì„ í†µí•´ ë™ì‹œ ì‘ì—…ì˜ êµ¬ì¡°ì™€ ê³„ì¸µì„ í™•ë¦½í•˜ë©°, ì·¨ì†Œ ë° ì˜¤ë¥˜ ì²˜ë¦¬ë¥¼ ìœ„í•œ ë©”ì»¤ë‹ˆì¦˜ ì œê³µ
- ì½”ë£¨í‹´ì€ í•˜ë‚˜ ì´ìƒì˜ JVM ìŠ¤ë ˆë“œì—ì„œ ì‹¤í–‰

## ğŸ“– 14.4 ì ì‹œ ë©ˆì¶œ ìˆ˜ ìˆëŠ” í•¨ìˆ˜: ì¼ì‹œ ì¤‘ë‹¨ í•¨ìˆ˜

- ì½”í‹€ë¦° ì½”ë£¨í‹´ì´ ìŠ¤ë ˆë“œ, ë°˜ì‘í˜• ìŠ¤íŠ¸ë¦¼, ì½œë°±ê³¼ ê°™ì€ ë‹¤ë¥¸ ë™ì‹œì„± ì ‘ê·¼ ë°©ì‹ê³¼ ë‹¤ë¥¸ í•µì‹¬ ì†ì„±ìœ¼ë¡œëŠ” ìƒë‹¨ìˆ˜ì˜ ê²½ìš° ì½”ë“œ **í˜•íƒœ**ë¥¼ í¬ê²Œ ë³€ê²½í•  í•„ìš”ê°€ ì—†ë‹¤ëŠ” ì ì´ ìˆë‹¤.

### ğŸ”– 14.4.1 ì¼ì‹œ ì¤‘ë‹¨ í•¨ìˆ˜ë¥¼ ì‚¬ìš©í•œ ì½”ë“œëŠ” ìˆœì°¨ì ìœ¼ë¡œ ë³´ì¸ë‹¤

```kotlin
fun login(credentials: Credentials): UserID
fun loadUserData(userID: UserID): UserData
fun showData(data: UserData)

fun showUserInfo(credentials: Credentials) {
    val userID = login(credentials)
    val userData = loadUserData(userID)
    showData(userData)
}
```

- ë¸”ë¡ëœ ìŠ¤ë ˆë“œëŠ” ìì›ì„ ë‚­ë¹„

```kotlin
suspend fun login(credentials: Credentials): UserID
suspend fun loadUserData(userID: UserID): UserData
fun showData(data: UserData)

fun showUserInfo(credentials: Credentials) {
    val userID = login(credentials)
    val userData = loadUserData(userID)
    showData(userData)
}
```

- `suspend` ë³€ê²½ìëŠ” í•¨ìˆ˜ê°€ ì‹¤í–‰ì„ ì ì‹œ ë©ˆì¶œ ìˆ˜ë„ ìˆë‹¤ëŠ” ëœ»
    - ex) ë„¤íŠ¸ì›Œí¬ ì‘ë‹µì„ ê¸°ë‹¤ë¦¬ëŠ” ê²½ìš° ì‹¤í–‰ì„ ì¼ì‹œ ì¤‘ë‹¨
- ì¼ì‹œ ì¤‘ë‹¨ì€ ê¸°ì € ìŠ¤ë ˆë“œë¥¼ ë¸”ë¡ì‹œí‚¤ì§€ ì•ŠëŠ”ë‹¤.
- ë¬¼ë¡  `login`ê³¼ `loadUserData`ì˜ êµ¬í˜„ë„ ì½”í‹€ë¦° ì½”ë£¨í‹´ì„ ê³ ë ¤í•´ ì‘ì„±ë¼ì•¼ í•œë‹¤.

## ğŸ“– 14.5 ì½”ë£¨í‹´ì„ ë‹¤ë¥¸ ì ‘ê·¼ ë°©ë²•ê³¼ ë¹„êµ

```kotlin
fun loginAsync(credentials: Credentials, callback: (UserID) -> Unit) {}
fun loadUserDataAsync(userID: UserID, callback: (UserData) -> Unit) {}
fun showData(data: UserData) {}

fun showUserInfo(credentials: Credentials) {
    loginAsync(credentials) { userID ->
        loadUserDataAsync(userID) { userData ->
            showData(userData)
        }
    }
}
```

- ë¡œì§ì´ ì»¤ì§€ë©´ ì½œë°±ì´ ì¤‘ì²©ëœ ì½”ë“œê°€ ë¼ ê°€ë…ì„±ì´ ê¸‰ê²©íˆ ë–¨ì–´ì§„ë‹¤.
    - ì½œë°± ì§€ì˜¥

```kotlin
fun loginAsync(credentials: Credentials): CompletableFuture<UserID>
fun loadUserDataAsync(userID: UserID): CompletableFuture<UserData>
fun showData(data: UserData)

fun showUserInfo(credentials: Credentials) {
    loginAsync(credentials)
        .thenCompose { loadUserDataAsync(it) }
        .thenAccept { showData(it) }
}
```

- `CompletableFuture`ì„ ì‚¬ìš©í•˜ë©´ ì½œë°± ì§€ì˜¥ì„ í”¼í•  ìˆ˜ ìˆì§€ë§Œ ìƒˆë¡œìš´ ì—°ì‚°ìì˜ ì˜ë¯¸ë¥¼ ë°°ì›Œì•¼ í•œë‹¤.
- í•¨ìˆ˜ì˜ ë°˜í™˜ íƒ€ì…ë„ ë³€ê²½í•´ì•¼ í•œë‹¤.

```kotlin
fun login(credentials: Credentials): Single<UserID>
fun loadUserData(userID: UserID): Single<UserData>
fun showData(data: UserData)

fun showUserInfo(credentials: Credentials) {
    login(credentials)
        .flatMap { loadUserData(it) }
        .doOnSuccess { showData(it) }
        .subscribe()
}
```

- ë°˜ì‘í˜• ìŠ¤íŠ¸ë¦¼ì„ í†µí•œ êµ¬í˜„ì€ ì½œë°± ì§€ì˜¥ì„ í”¼í•  ìˆ˜ ìˆì§€ë§Œ í•¨ìˆ˜ ì‹œê·¸ë‹ˆì²˜ ë³€ê²½ ë° ì—°ì‚°ìë¥¼ ì‚¬ìš©í•´ì•¼ í•œë‹¤.

ìœ„ì™€ ë¹„êµí•´ë³´ë©´ ì½”ë£¨í‹´ì„ ì‚¬ìš©í•˜ëŠ” ì ‘ê·¼ ë°©ì‹ì—ì„œëŠ” í•¨ìˆ˜ì— `suspend` ë³€ê²½ìë§Œ ì¶”ê°€í•˜ë©´ ëœë‹¤.

### ğŸ”– 14.5.1 ì¼ì‹œ ì¤‘ë‹¨ í•¨ìˆ˜ í˜¸ì¶œ

- ì¼ì‹œ ì¤‘ë‹¨ í•¨ìˆ˜ëŠ” ì‹¤í–‰ì„ ì¼ì‹œ ì¤‘ë‹¨í•  ìˆ˜ ìˆê¸° ë•Œë¬¸ì— ì¼ë°˜ ì½”ë“œ ì•„ë¬´ ê³³ì—ì„œë‚˜ í˜¸ì¶œí•  ìˆ˜ëŠ” ã…‡ë²—ë‹¤.
- ì¼ì‹œ ì¤‘ë‹¨ í•¨ìˆ˜ ì‹¤í–‰ì„ ì¼ì‹œ ì¤‘ë‹¨í•  ìˆ˜ ìˆëŠ” ì½”ë“œ ë¸”ë¡ ì•ˆì—ì„œë§Œ í˜¸ì¶œí•  ìˆ˜ ìˆë‹¤.
- ê·¸ëŸ° ë¸”ë¡ ì¤‘ í•˜ë‚˜ê°€ ë‹¤ë¥¸ ì¼ì‹œ ì¤‘ë‹¨ í•¨ìˆ˜ì¼ ìˆ˜ ìˆë‹¤.

```kotlin
suspend fun mySuspendingFunction() {}

fun main() {
    mySuspendingFunction() // error
}
```

- ì¼ë°˜ì ì¸ ì¼ì‹œ ì¤‘ë‹¨ ì½”ë“œê°€ ì•„ë‹Œ ì½”ë“œì—ì„œ ì¼ì‹œ ì¤‘ë‹¨ í•¨ìˆ˜ë¥¼ í˜¸ì¶œí•˜ë ¤ê³  í•˜ë©´ ì˜¤ë¥˜ê°€ ë°œìƒ
- main í•¨ìˆ˜ë¥¼ `suspend`ë¡œ í•˜ë©´ í˜¸ì¶œ ê°€ëŠ¥

## ğŸ“– 14.6 ì½”ë£¨í‹´ ì„¸ê³„ë¡œ ë“¤ì–´ê°€ê¸°: ì½”ë£¨í‹´ ë¹Œë”

- ì½”ë£¨í‹´ì€ ì¼ì‹œ ì¤‘ë‹¨ ê°€ëŠ¥í•œ ê³„ì‚°ì˜ ì¸ìŠ¤í„´ìŠ¤ë‹¤.
- ë‹¤ë¥¸ ì½”ë£¨í‹´ë“¤ê³¼ ë™ì‹œì— ì‹¤í–‰ë  ìˆ˜ ìˆëŠ” ì½”ë“œ ë¸”ë¡
- ìŠ¤ë ˆë“œì™€ ë¹„ìŠ·í•˜ì§€ë§Œ ì½”ë£¨í‹´ì€ í•¨ìˆ˜ ì‹¤í–‰ì„ ì¼ì‹œ ì¤‘ë‹¨í•˜ëŠ” ë° í•„ìš”í•œ ë©”ì»¤ë‹ˆì¦˜ì„ í¬í•¨í•˜ê³  ìˆë‹¤.
    - `runBlocking`ì€ ë¸”ë¡œí‚¹ ì½”ë“œì™€ ì¼ì‹œ ì¤‘ë‹¨ í•¨ìˆ˜ì˜ ì„¸ê³„ë¥¼ ì—°ê²°í•  ë•Œ ì“°ì¸ë‹¤.
    - `launch`ëŠ” ê°’ì„ ë°˜í™˜í•˜ì§€ ì•ŠëŠ” ìƒˆë¡œìš´ ì½”ë£¨í‹´ì„ ì‹œì‘í•  ë•Œ ì“°ì¸ë‹¤.
    - `async`ëŠ” ë¹„ë™ê¸°ì ìœ¼ë¡œ ê°’ì„ ê³„ì‚°í•  ë•Œ ì“°ì¸ë‹¤.

### ğŸ”– 14.6.1 ì¼ë°˜ ì½”ë“œì—ì„œ ì½”ë£¨í‹´ì˜ ì„¸ê³„ë¡œ: runBlocking

```kotlin
suspend fun doSomethingSlowly() {
    delay(500.milliseconds)
    println("I'm done")
}

fun main() = runBlocking {
    doSomethingSlowly()
}
```

- ìƒˆ ì½”ë£¨í‹´ì„ ìƒì„±í•˜ê³  ì‹¤í–‰í•˜ë©°, í•´ë‹¹ ì½”ë£¨í‹´ì´ ì™„ë£Œë  ë•Œê¹Œì§€ í˜„ì¬ ìŠ¤ë ˆë“œë¥¼ ë¸”ë¡ì‹œí‚¨ë‹¤.
- `runBlocking`ì„ ì‚¬ìš©í•  ë•ŒëŠ” í•˜ë‚˜ì˜ ìŠ¤ë ˆë“œë¥¼ ë¸”ë¡œí‚¹í•œë‹¤.
- ë‹¤ë§Œ, ì¶”ê°€ì ì¸ ìì‹ ì½”ë£¨í‹´ì„ ì–¼ë§ˆë“ ì§€ ì‹œì‘í•  ìˆ˜ ìˆê³ , ì´ë“¤ì€ ë‹¤ë¥¸ ìŠ¤ë ˆë“œë¥¼ ë” ì´ìƒ ë¸”ë¡ì‹œí‚¤ì§€ ì•ŠëŠ”ë‹¤.

### ğŸ”– 14.6.2 ë°œì‚¬ í›„ ë§ê° ì½”ë£¨í‹´ ìƒì„±: launch í•¨ìˆ˜

```kotlin
private var zeroTime = System.currentTimeMillis()
fun log(message: Any?) =
    println("${System.currentTimeMillis() - zeroTime} " + "[${Thread.currentThread().name}] $message")

fun main() = runBlocking {
    log("The first, parent, coroutine starts")
    launch {
        log("The second coroutine starts and is ready to be suspended")
        delay(100.milliseconds)
        log("The second coroutine is resumed")
    }
    launch {
        log("The third coroutine can run in the meantime")
    }
    log("The first coroutine has launched two more coroutines")
}
```

- ì´ ì˜ˆì œë¥¼ ì‹¤í–‰í•˜ë©´ ì•„ë˜ì™€ ê°™ì€ ê²°ê³¼ê°€ ì¶œë ¥ëœë‹¤.
    - `-Dkotlinx.coroutines.debug` JVM ì˜µì…˜ í¬í•¨ ì‹¤í–‰

```text
38 [main @coroutine#1] The first, parent, coroutine starts
52 [main @coroutine#1] The first coroutine has launched two more coroutines
53 [main @coroutine#2] The second coroutine starts and is ready to be suspended
58 [main @coroutine#3] The third coroutine can run in the meantime
163 [main @coroutine#2] The second coroutine is resumed
```

- ë³‘ë ¬ì„± ì—†ì´ êµì°¨ ì‹¤í–‰ë˜ëŠ” ê²½ìš°ë‹¤. ì¦‰, ëª¨ë“  ì½”ë£¨í‹´ì´ ê°™ì€ ìŠ¤ë ˆë“œì—ì„œ ì‹¤í–‰
- `launch`ë¥¼ ì‚¬ìš©í•´ ìƒˆë¡œìš´ ê¸°ë³¸ ì½”ë£¨í‹´ì„ ì‹œì‘í•  ìˆ˜ ì‡ë‹¤.

### ğŸ”– 14.6.3 ëŒ€ê¸° ê°€ëŠ¥í•œ ì—°ì‚°: async ë¹Œë”

```kotlin
suspend fun slowlyAddNumbers(a: Int, b: Int): Int {
    log("Waiting a bit before calculating $a + $b")
    delay(100.milliseconds * a)
    return a + b
}

fun main() = runBlocking {
    log("Starting the async computation")
    val myFirstDeferred = async { slowlyAddNumbers(2, 2) }
    val mySecondDeferred = async { slowlyAddNumbers(4, 4) }
    log("Waiting for the deferred value to be available")
    log("The first result: ${myFirstDeferred.await()}")
    log("The second result: ${mySecondDeferred.await()}")
}
```

- ì´ ì˜ˆì œë¥¼ ì‹¤í–‰í•˜ë©´ ì•„ë˜ì™€ ê°™ì€ ê²°ê³¼ê°€ ì¶œë ¥ëœë‹¤.

```text
44 [main @coroutine#1] Starting the async computation
60 [main @coroutine#1] Waiting for the deferred value to be available
65 [main @coroutine#2] Waiting a bit before calculating 2 + 2
71 [main @coroutine#3] Waiting a bit before calculating 4 + 4
287 [main @coroutine#1] The first result: 4
481 [main @coroutine#1] The second result: 8
```

- `async`ë¥¼ í˜¸ì¶œí•  ë•Œë§ˆë‹¤ ìƒˆë¡œìš´ ì½”ë£¨í‹´ì„ ì‹œì‘í•¨ìœ¼ë¡œì¨ ë‘ ê³„ì‚°ì´ ë™ì‹œì— ì¼ì–´ë‚˜ê²Œ í–ˆë‹¤.
- `await`ë¥¼ í˜¸ì¶œí•˜ë©´ ê·¸ `Deferred`ì—ì„œ ê²°ê´ê°’ì´ ì‚¬ìš© ê°€ëŠ¥í•´ì§ˆ ë•Œê¹Œì§€ ë£¨íŠ¸ ì½”ë£¨í‹´ì´ ì¼ì‹œ ì¤‘ë‹¨ëœë‹¤.
- `Deferred` ê°ì²´ëŠ” ì•„ì§ ì‚¬ìš©í•  ìˆ˜ ì—†ëŠ” ê°’ì„ ë‚˜íƒ€ë‚¸ë‹¤.
    - ë§¤ë˜ì— ì–¸ì  ê°€ëŠ” ê°’ì„ ì•Œê²Œ ë  ê²ƒì´ë¼ëŠ” ì•½ì†, ì—°ê¸°ëœ ê³„ì‚° ê²°ê´ê°’ì„ ë‚˜íƒ€ë‚¸ë‹¤.

| ë¹Œë”            | ë°˜í™˜ê°’           | ì“°ì„ìƒˆ                       |
|---------------|---------------|---------------------------|
| `runBlocking` | ëŒë‹¤ê°€ ê³„ì‚°í•œ ê°’     | ë¸”ë¡œí‚¹ ì½”ë“œì™€ ë„Œë¸”ë¡œí‚¹ ì½”ë“œ ì‚¬ì´ë¥¼ ì—°ê²°    |
| `launch`      | `Job`         | ë°œì‚¬ í›„ ë§ê° ì½”ë£¨í‹´ ì‹œì‘(ë¶€ìˆ˜ íš¨ê³¼ê°€ ìˆìŒ) |
| `async`       | `Deferred<T>` | ê°’ì„ ë¹„ë™ê¸°ë¡œ ê³„ì‚°(ê°’ì„ ê¸°ë‹¤ë¦´ ìˆ˜ ìˆìŒ)   |

## ğŸ“– 14.7 ì–´ë””ì„œ ì½”ë“œë¥¼ ì‹¤í–‰í• ì§€ ì •í•˜ê¸°: ë””ìŠ¤íŒ¨ì²˜

- ì½”ë£¨í‹´ì˜ ë””ìŠ¤íŒ¨ì²˜ëŠ” ì½”ë£¨í‹´ì„ ì‹¤í–‰í•  ìŠ¤ë ˆë“œë¥¼ ê²°ì •
- ë””ìŠ¤íŒ¨ì²˜ë¥¼ ì„ íƒí•¨ìœ¼ë¡œì¨ ì½”ë£¨í‹´ì„ íŠ¹ì • ìŠ¤ë ˆë“œë¡œ ì œí•œí•˜ê±°ë‚˜ ìŠ¤ë ˆë“œ í’€ì— ë¶„ì‚°ì‹œí‚¬ ìˆ˜ ìˆìœ¼ë©°, ì½”ë£¨í‹´ì´ í•œ ìŠ¤ë ˆë“œì—ì„œë§Œ ì‹¤í–‰ë ì§€ ì—¬ëŸ¬ ìŠ¤ë ˆë“œì—ì„œ ì‹¤í–‰ë ì§€ ê²°ì •í•  ìˆ˜ ìˆë‹¤.

### ğŸ”– 14.7.1 ë””ìŠ¤íŒ¨ì²˜ ì„ íƒ

- ì½”ë£¨í‹´ì€ ê¸°ë³¸ì ìœ¼ë¡œ ë¶€ëª¨ ì½”ë£¨í‹´ì—ì„œ ë””ìŠ¤íŒ¨ì²˜ë¥¼ ìƒì†ë°›ìœ¼ë¯€ë¡œ ëª¨ë“  ì½”ë£¨í‹´ì— ëŒ€í•´ ëª…ì‹œì ìœ¼ë¡œ ë””ìŠ¤íŒ¨ì²˜ë¥¼ ì§€ì •í•  í•„ìš”ëŠ” ì—†ë‹¤.

#### ğŸ› ï¸ ë‹¤ì¤‘ ìŠ¤ë ˆë“œë¥¼ ì‚¬ìš©í•˜ëŠ” ë²”ìš© ë””ìŠ¤íŒ¨ì²˜: Dispatchers.Default

- ê°€ì¥ ì¼ë°˜ì ì¸ ë””ìŠ¤íŒ¨ì²˜
- CPU ì½”ì–´ ìˆ˜ë§Œí¼ì˜ ìŠ¤ë ˆë“œë¡œ êµ¬ì„±ëœ ìŠ¤ë ˆë“œ í’€ì„ ê¸°ë°˜ìœ¼ë¡œ í•¨
- ì—¬ëŸ¬ ìŠ¤ë ˆë“œì—ì„œ ì½”ë£¨í‹´ì´ ë¶„ì‚°ë¼ ì‹¤í–‰

#### ğŸ› ï¸ UI ìŠ¤ë ˆë“œì—ì„œ ì‹¤í–‰: Dispatchers.Main

- UI í”„ë ˆì„ì›Œí¬ë¥¼ ì‚¬ìš©í•  ë•ŒëŠ” íŠ¹ì • ì‘ì—…ì„ UI ìŠ¤ë ˆë“œë‚˜ ë©”ì¸ ìŠ¤ë ˆë“œë¼ê³  ë¶ˆë¦¬ëŠ” íŠ¹ì • ìŠ¤ë ˆë“œì—ì„œ ì‹¤í–‰í•´ì•¼ ë  ë•Œê°€ ìˆë‹¤.
- `Dispatchers.Main`ì˜ ì‹¤ì œ ê°’ì€ ì‚¬ìš©í•˜ëŠ” í”„ë ˆì„ì›Œí¬ì— ë”°ë¼ ë‹¤ë¥´ë‹¤.

#### ğŸ› ï¸ ë¸”ë¡œí‚¹ë˜ëŠ” IO ì‘ì—… ì²˜ë¦¬: Dispatchers.IO

- ì„œë“œíŒŒí‹° ë¼ì´ë¸ŒëŸ¬ë¦¬ë¥¼ ì‚¬ìš©í•  ë•Œ ì½”ë£¨í‹´ì„ ì—¼ë‘ì— ë‘ê³  ì„¤ê³„ëœ APIë¥¼ ì„ íƒí•  ìˆ˜ ì—†ëŠ” ê²½ìš°
- `Dispatchers.IO`ì—ì„œ ì‹¤í–‰ëœ ì½”ë£¨í‹´ì€ ìë™ìœ¼ë¡œ í™•ì¥ë˜ëŠ” ìŠ¤ë ˆë“œ í’€ì—ì„œ ì‹¤í–‰
- CPU ì§‘ì•½ì ì´ì§€ ì•Šì€ ì‘ì—…(ë¸”ë¡œí‚¹ API ì‘ë‹µ ëŒ€ê¸°)ì— ì í•©

| ë””ìŠ¤íŒ¨ì²˜                     | ìŠ¤ë ˆë“œ ê°œìˆ˜                           | ì“°ì„ìƒˆ                       |
|--------------------------|----------------------------------|---------------------------|
| `Dispatchers.Default`    | CPU ì½”ì–´ ìˆ˜                         | ì¼ë°˜ì ì¸ ì—°ì‚°, CPU ì§‘ì•½ì ì¸ ì‘ì—…      |
| `Dispatchers.Main`       | 1                                | UI í”„ë ˆì„ì›Œí¬ì˜ ë§¥ë½ì—ì„œë§Œ ì‘ì—…        |
| `Dispatchers.IO`         | 64 + CPU ì½”ì–´ ê°œìˆ˜(ë‹¨, ìµœëŒ€ 64ê°œë§Œ ë³‘ë ¬ ì‹¤í–‰) | ë¸”ë¡œí‚¹ IO ì‘ì—…, ë„¤íŠ¸ì›Œí¬ ì‘ì—…, íŒŒì¼ ì‘ì—… |
| `Dispatchers.Unconfined` | ì•„ë¬´ ìŠ¤ë ˆë“œë‚˜                          | ì¦‰ì‹œ ìŠ¤ì¼€ì¤„ë§í•´ì•¼ í•˜ëŠ” íŠ¹ë³„í•œ ê²½ìš°       |
| `limitedParallelism(n)`  | ì»¤ìŠ¤í…€(n)                           | ì»¤ìŠ¤í…€ ì‹œë‚˜ë¦¬ì˜¤                  |

### ğŸ”– 14.7.2 ì½”ë£¨í‹´ ë¹Œë”ì— ë””ìŠ¤íŒ¨ì²˜ ì „ë‹¬

```kotlin
fun main() {
    runBlocking {
        log("Doing some work")
        launch(Dispatchers.Default) {
            log("Doing some background work")
        }
    }
}
```

- ì½”ë£¨í‹´ ë¹Œë” í•¨ìˆ˜ëŠ” ì½”ë£¨í‹´ ë””ìŠ¤íŒ¨ì²˜ë¥¼ ëª…ì‹œì ìœ¼ë¡œ ì§€ì •í•  ìˆ˜ ìˆê²Œ í•œë‹¤.
- ìœ„ ì½”ë“œì˜ ì‹¤í–‰ ê²°ê³¼ëŠ” ì•„ë˜ì™€ ê°™ë‹¤.

```text
45 [main @coroutine#1] Doing some work
63 [DefaultDispatcher-worker-2 @coroutine#2] Doing some background work
```

### ğŸ”– 14.7.3 withContextë¥¼ ì‚¬ìš©í•´ ì½”ë£¨í‹´ ì•ˆì—ì„œ ë””ìŠ¤íŒ¨ì²˜ ë°”ê¾¸ê¸°

```kotlin
launch(Dispatchers.Default) {
    val result = performBackgroundOperation()
    withContext(Dispatchers.Main) {
        updateUI(result)
    }
}
```

- ì´ë¯¸ ì‹¤í–‰ ì¤‘ì¸ ì½”ë£¨í‹´ì—ì„œ ë””ìŠ¤íŒ¨ì²˜ë¥¼ ë°”ê¿€ ë•ŒëŠ” `withContext` í•¨ìˆ˜ì— ë‹¤ë¥¸ ë””ìŠ¤íŒ¨ì²˜ë¥¼ ì „ë‹¬

### ğŸ”– 14.7.4 ì½”ë£¨í‹´ê³¼ ë””ìŠ¤íŒ¨ì²˜ëŠ” ìŠ¤ë ˆë“œ ì•ˆì „ì„± ë¬¸ì œì— ëŒ€í•œ ë§ˆë²• ê°™ì€ í•´ê²°ì±…ì´ ì•„ë‹ˆë‹¤

```kotlin
fun main() {
    runBlocking {
        launch(Dispatchers.Default) {
            var x = 0
            repeat(10_000) {
                x++
            }
            println(x)
        }
    }
}
```

- ì½”ë£¨í‹´ì´ ì¢…ë£Œëœ í›„ x ê°’ì€ 10000ìœ¼ë¡œ ì •í™•í•˜ë‹¤.
- í•œ ì½”ë£¨í‹´ì´ ì„ì˜ì˜ ìŠ¤ë ˆë“œì—ì„œ ì‹¤í–‰ë˜ë”ë¼ë„ ê·¸ ë¡œì§ì´ ì—„ê²©í•˜ê²Œ ìˆœì°¨ì ìœ¼ë¡œ ì‹¤í–‰ë˜ê¸° ë•Œë¬¸

```kotlin
fun main() {
    runBlocking {
        var x = 0
        repeat(10_000) {
            launch(Dispatchers.Default) {
                x++
            }
        }
        delay(1.seconds)
        println(x)
    }
}
```

- ì¹´ìš´í„° ê°’ì´ ì˜ˆìƒë³´ë‹¤ ë‚®ë‹¤.
- ì—¬ëŸ¬ ì½”ë£¨í‹´ì´ ê°™ì€ ë°ì´í„°ë¥¼ ìˆ˜ì •í•˜ê³  ìˆê¸° ë•Œë¬¸

```kotlin
fun main() = runBlocking {
    val mutex = Mutex()
    var x = 0
    repeat(10_000) {
        launch(Dispatchers.Default) {
            mutex.withLock {
                x++
            }
        }
    }
    delay(1.seconds)
    println(x)
}
```

- `Mutex` ì ê¸ˆì„ í†µí•´ ì½”ë“œ ì„ê³„ ì˜ì—­ì´ í•œ ë²ˆì— í•˜ë‚˜ì˜ ì½”ë£¨í‹´ë§Œ ì‹¤í–‰ë˜ê²Œ ë³´ì¥í•  ìˆ˜ ìˆë‹¤.

## ğŸ“– 14.8 ì½”ë£¨í‹´ì€ ì½”ë£¨í‹´ ì½˜í…ìŠ¤íŠ¸ì— ì¶”ê°€ì ì¸ ì •ë³´ë¥¼ ë‹´ê³  ìˆë‹¤

- ê° ì½”ë£¨í‹´ì€ ì¶”ê°€ì ì¸ ë¬¸ë§¥ ì •ë³´ë¥¼ ë‹´ê³  ìˆëŠ”ë°, ì´ ë¬¸ë§¥ì€ `CoroutineContext`ë¼ëŠ” í˜•íƒœë¡œ ì œê³µ
- `CoroutineContext`ëŠ” ì—¬ëŸ¬ ìš”ì†Œë¡œ ì´ë¤„ì§„ ì§‘í•©
- ì´ ìš”ì†Œ ì¤‘ í•˜ë‚˜ëŠ” ì½”ë£¨í‹´ì´ ì–´ë–¤ ìŠ¤ë ˆë“œì—ì„œ ì‹¤í–‰ë ì§€ë¥¼ ê²°ì •í•˜ëŠ” ë””ìŠ¤íŒ¨ì²˜
- `CoroutineContext`ì—ëŠ” ì½”ë£¨í‹´ì˜ ìƒëª…ì£¼ê¸°ì™€ ì·¨ì†Œë¥¼ ê´€ë¦¬í•˜ëŠ” `Job` ê°ì²´ í¬í•¨
- `CoroutineContext`ì—ëŠ” `CoroutineNmae`, `CoroutineExceptionHandler`ì™€ ê°™ì€ ë©”íƒ€ë°ì´í„°ë„ í¬í•¨

```kotlin
suspend fun introspect() {
    log(coroutineContext)
}

fun main() {
    runBlocking {
        introspect()
    }
}
```

- ìœ„ ê²°ê³¼ëŠ” ì•„ë˜ì™€ ê°™ë‹¤.

```text
39 [main @coroutine#1] [CoroutineId(1), "coroutine#1":BlockingCoroutine{Active}@32709393, BlockingEventLoop@3d99d22e]
```

```kotlin
fun main() {
    runBlocking(Dispatchers.IO + CoroutineName("Coolroutine")) {
        introspect()
    }
}
```

- ì½”ë£¨í‹´ ë¹Œë”ì— ì¸ìë¥¼ ì „ë‹¬í•˜ë©´ ìì‹ ì½”ë£¨í‹´ì˜ ì½˜í…ìŠ¤íŠ¸ì—ì„œ í•´ë‹¹ ìš”ì†Œë¥¼ ë®ì–´ì“´ë‹¤.

```text
43 [DefaultDispatcher-worker-1 @Coolroutine#1] [CoroutineName(Coolroutine), CoroutineId(1), "Coolroutine#1":BlockingCoroutine{Active}@1be729a6, Dispatchers.IO]
```