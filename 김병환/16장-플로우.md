# ğŸ“š 16ì¥ í”Œë¡œìš°

## ğŸ“– 16.1 í”Œë¡œìš°ëŠ” ì—°ì†ì ì¸ ê°’ì˜ ìŠ¤íŠ¸ë¦¼ì„ ëª¨ë¸ë§í•œë‹¤

```kotlin
suspend fun createValues(): List<Int> {
    return buildList {
        add(1)
        delay(1.seconds)
        add(2)
        delay(1.seconds)
        add(3)
        delay(1.seconds)
    }
}

fun main() = runBlocking {
    val list = createValues()
    list.forEach {
        log(it)
    }
}
```

- ëª¨ë“  ê°’ì´ ê³„ì‚° ëœ í›„ í•¨ìˆ˜ê°€ ê°’ì„ ë°˜í™˜í•¨.
- í•¨ìˆ˜ê°€ ì‹¤í–‰ì„ ë§ˆì¹  ë•Œê¹Œì§€ ê¸°ë‹¤ë¦¬ì§€ ì•Šê³  ê°’ì„ ì‚¬ìš©í•  ìˆ˜ ìˆë„ë¡ ë¹„ë™ê¸°ì ìœ¼ë¡œ ë°˜í™˜í•˜ê³  ì‹¶ì„ ë•Œ í”Œë¡±ìš°ê°€ ìœ ìš©í•˜ë‹¤.
- í”Œë¡œìš°ëŠ” ì‹œê°„ì´ ì§€ë‚¨ì— ë”°ë¼ ë‚˜íƒ€ë‚˜ëŠ” ê°’ê³¼ ì‘ì—…í•  ìˆ˜ ìˆê²Œ í•´ì£¼ëŠ” ì½”ë£¨í‹´ ê¸°ë°˜ì˜ ì¶”ìƒí™”ë‹¤

### ğŸ”– 16.1.1 í”Œë¡œìš°ë¥¼ ì‚¬ìš©í•˜ë©´ ë°°ì¶œë˜ìë§ˆì ì›ì†Œë¥¼ ì²˜ë¦¬í•  ìˆ˜ ìˆë‹¤

```kotlin
fun createValues(): Flow<Int> {
    return flow {
        emit(1)
        delay(1.seconds)
        emit(2)
        delay(1.seconds)
        emit(3)
        delay(1.seconds)
    }
}

fun main() = runBlocking {
    val myFlowOfValues = createValues()
    myFlowOfValues.collect { log(it) }
}
```

```text
0 [main @coroutine#1] 1
1036 [main @coroutine#1] 2
2042 [main @coroutine#1] 3
```

- ì›ì†Œê°€ ë°°ì¶œë˜ëŠ” ì¦‰ì‹œ í‘œì‹œëœë‹¤.

### ğŸ”– 16.1.2 ì½”í‹€ë¦° í”Œë¡œìš°ì˜ ì—¬ëŸ¬ ìœ í˜•

- ì½œë“œ í”Œë¡œìš°
    - ë¹„ë™ê¸° ë°ì´í„° ìŠ¤íŠ¸ë¦¼
    - ê°’ì´ ì‹¤ì œë¡œ ì†Œë¹„ë˜ê¸° ì‹œì‘í•  ë•Œë§Œ ê°’ì„ ë°°ì¶œ
- í•« í”Œë¡œìš°
    - ë¸Œë¡œë“œìºìŠ¤íŠ¸ ë°©ì‹
    - ê°’ì´ ì‹¤ì œë¡œ ì†Œë¹„ë˜ê³  ìˆëŠ”ì§€ì™€ ìƒê´€ì—†ì´ ë…ë¦½ì ìœ¼ë¡œ ë°°ì¶œ

## ğŸ“– 16.2 ì½œë“œ í”Œë¡œìš°

### ğŸ”– 16.2.1 flow ë¹Œë” í•¨ìˆ˜ë¥¼ ì‚¬ìš©í•´ ì½œë“œ í”Œë¡œìš° ìƒì„±

```kotlin
fun main() = runBlocking {
    val letters = flow {
        log("Emitting A!")
        emit("A")
        delay(200.milliseconds)
        log("Emitting B!")
        emit("B")
    }
}
```

- ì•„ë¬´ëŸ° ì¶œë ¥ë„ ë‚˜íƒ€ë‚˜ì§€ ì•ŠëŠ”ë‹¤.
- `flow` ë¹Œë” í•¨ìˆ˜ë¥¼ í˜¸ì¶œí•´ë„ ì‹¤ì œ ì‘ì—…ì´ ì‹œì‘ë˜ì§€ ì•ŠìŒ.

```kotlin
val counterFlow = flow {
    var x = 0
    while (true) {
        emit(x++)
        delay(200.milliseconds)
    }
}
```

- ì´ ë£¨í”„ëŠ” ì‹¤ì œë¡œ í”Œë¡œìš°ê°€ ìˆ˜ì§‘ë  ë•Œë§Œ ì‹¤í–‰

### ğŸ”– 16.2.2 ì½œë“œ í”Œë¡œìš°ëŠ” ìˆ˜ì§‘ë˜ê¸° ì „ê¹Œì§€ ì‘ì—…ì„ ìˆ˜í–‰í•˜ì§€ ì•ŠëŠ”ë‹¤

- `Flow`ì— ëŒ€í•´ `collect` í•¨ìˆ˜ë¥¼ í˜¸ì¶œí•˜ë©´ ê·¸ ë¡œì§ì´ ì‹¤í–‰ëœë‹¤
- í”Œë¡œìš°ë¥¼ ìˆ˜ì§‘í•  ë•ŒëŠ” í”Œë¡œìš° ë‚´ë¶€ì˜ ì¼ì‹œ ì¤‘ë‹¨ ì½”ë“œë¥¼ ì‹¤í–‰í•˜ë¯€ë¡œ `collect`ëŠ” ì¼ì‹œ ì¤‘ë‹¨ í•¨ìˆ˜ì´ë©°, í”Œë¡œìš°ê°€ ëë‚  ë•Œê¹Œì§€ ì¼ì‹œ ì¤‘ë‹¨ëœë‹¤.

```kotlin
val letters = flow {
    log("Emitting A!")
    emit("A")
    delay(200.milliseconds)
    log("Emitting B!")
    emit("B")
}

fun main() = runBlocking {
    letters.collect {
        log("Collecting: $it")
        delay(500.milliseconds)
    }
}
```

```text
0 [main @coroutine#1] Emitting A!
15 [main @coroutine#1] Collecting: A
737 [main @coroutine#1] Emitting B!
737 [main @coroutine#1] Collecting: B
```

- ìˆ˜ì§‘ìê°€ í”Œë¡œìš°ì˜ ë¡œì§ì„ ì‹¤í–‰í•˜ëŠ” ì±…ì„ì´ ìˆë‹¤.
- ì›ì†Œ A, B ì‚¬ì´ì˜ ì§€ì—°ì‹œê°„ì€ 700ë°€ë¦¬ì´ˆì´ë‹¤.
    - ìˆ˜ì§‘ìê°€ í”Œë¡œìš° ë¹Œë”ì— ì •ì˜ëœ ë¡œì§ì˜ ì‹¤í–‰ì„ ì´‰ë°œí•´ì„œ ì²« ë²ˆì§¸ ë°°ì¶œ ë°œìƒ
    - ìˆ˜ì§‘ìê°€ ì—°ê²°ëœ ëŒë‹¤ê°€ í˜¸ì¶œë˜ë©´ì„œ ë©”ì‹œì§€ë¥¼ ê¸°ë¡í•˜ê³  500ë°€ë¦¬ì´ˆ ë™ì•ˆ ì§€ì—°
    - í”Œë¡œìš° ëŒë‹¤ê°€ ê³„ì† ì‹¤í–‰ë˜ë©° 200ë°€ë¦¬ì´ˆ ë™ì•ˆ ì¶”ê°€ ì§€ì—°ê³¼ ë°°ì¶œì´ ë°œìƒ

```kotlin
fun main() = runBlocking {
    letters.collect {
        log("(1) Collecting: $it")
        delay(500.milliseconds)
    }
    letters.collect {
        log("(2) Collecting: $it")
        delay(500.milliseconds)
    }
}
```

```text
0 [main @coroutine#1] Emitting A!
16 [main @coroutine#1] (1) Collecting: A
743 [main @coroutine#1] Emitting B!
743 [main @coroutine#1] (1) Collecting: B
1247 [main @coroutine#1] Emitting A!
1247 [main @coroutine#1] (2) Collecting: A
1958 [main @coroutine#1] Emitting B!
1958 [main @coroutine#1] (2) Collecting: B
```

- ê°™ì€ í”Œë¡œìš°ë¥¼ ì—¬ëŸ¬ ë²ˆ ìˆ˜ì§‘í•  ìˆ˜ ìˆë‹¤.

### ğŸ”– 16.2.3 í”Œë¡œìš° ìˆ˜ì§‘ ì·¨ì†Œ

```kotlin
fun main() = runBlocking {
    val collector = launch {
        counterFlow.collect {
            println(it)
        }
    }
    delay(5.seconds)
    collector.cancel()
}
```

- ìˆ˜ì§‘ìì˜ ì½”ë£¨í‹´ì„ ì·¨ì†Œí•˜ë©´ ë‹¤ìŒ ì·¨ì†Œ ì§€ì ì—ì„œ í”Œë¡œìš°ì˜ ìˆ˜ì§‘ì´ ì¤‘ë‹¨ëœë‹¤.

### ğŸ”– 16.2.4 ì½œë“œ í”Œë¡œìš°ì˜ ë‚´ë¶€ êµ¬í˜„

- ì½”í‹€ë¦°ì˜ ì½œë“œ í”Œë¡œìš°ëŠ” ì¼ì‹œ ì¤‘ë‹¨ í•¨ìˆ˜ì™€ ìˆ˜ì‹  ê°ì²´ ì§€ì • ëŒë‹¤ë¥¼ ê²°í•©í•œ ë˜‘ë˜‘í•œ ì¡°í•©ì´ë‹¤.
- ì½œë“œ í”Œë¡œìš°ì˜ ì •ì˜ëŠ” ë§¤ìš° ê°„ë‹¨í•˜ë‹¤.
    - `Flow`ì™€ `FlowCollector`ë¼ëŠ” 2ê°€ì§€ ì¸í„°í˜ì´ìŠ¤ë§Œ í•„ìš”
- `collect`ë¥¼ í˜¸ì¶œí•˜ë©´ í”Œë¡œìš° ë¹Œë” í•¨ìˆ˜ì˜ ë³¸ë¬¸ì´ ì‹¤í–‰
- ì´ ì½”ë“œê°€ `emit`ì„ í˜¸ì¶œí•˜ë©´ `emit`ì— ì „ë‹¬ëœ íŒŒë¼ë¯¸í„°ë¡œ `collect`ì— ì „ë‹¬ëœ ëŒë‹¤ê°€ í˜¸ì¶œ
- ëŒë‹¤ í‘œí˜„ì‹ì´ ì‹¤í–‰ì„ ì™„ë£Œí•˜ë©´ í•¨ìˆ˜ëŠ” ë¹Œë” í•¨ìˆ˜ì˜ ë³¸ë¬¸ìœ¼ë¡œ ëŒì•„ê°€ ê³„ì† ì‹¤í–‰
- ì½œë“œ í”Œë¡œìš°ëŠ” ê°’ ìŠ¤íŠ¸ë¦¼ì„ ì²˜ë¦¬í•˜ëŠ” ê°€ë²¼ìš°ë©´ì„œë„ ì•„ì£¼ ì“¸ëª¨ ìˆê³  í™•ì¥ì„± ìˆëŠ” ì¶”ìƒí™”ë¥¼ ì œê³µ

### ğŸ”– 16.2.5 ì±„ë„ í”Œë¡œìš°ë¥¼ ì‚¬ìš©í•œ ë™ì‹œì„± í”Œë¡œìš°

```kotlin
suspend fun getRandomNumber(): Int {
    delay(500.milliseconds)
    return Random.nextInt()
}

val randomNumbers = flow {
    repeat(10) {
        emit(getRandomNumber())
    }
}

fun main() = runBlocking {
    randomNumbers.collect {
        log(it)
    }
}
```

```text
0 [main @coroutine#1] -1441864547
513 [main @coroutine#1] 1101626017
1020 [main @coroutine#1] 313359960
1527 [main @coroutine#1] -2002910241
2033 [main @coroutine#1] 890150628
2538 [main @coroutine#1] -1433970862
3045 [main @coroutine#1] 1503636281
3548 [main @coroutine#1] -1528949568
4055 [main @coroutine#1] -1562012272
4561 [main @coroutine#1] 2076525050
```

- í”Œë¡œìš°ëŠ” ìˆœì°¨ì ìœ¼ë¡œ ì‹¤í–‰ë˜ë©°, ëª¨ë“  ê³„ì‚°ì€ ë™ì¼ ì½”ë£¨í‹´ì—ì„œ ì‹¤í–‰

```kotlin
val randomNumbers = channelFlow {
    repeat(10) {
        launch {
            send(getRandomNumber())
        }
    }
}
```

- ë™ì‹œì„±ìœ¼ë¡œ í˜¸ì¶œí•  ìˆ˜ ìˆëŠ” í”Œë¡œìš° ë¹Œë”: `channelFlow`
- ì±„ë„ í”Œë¡œìš°ëŠ” ë‚´ë¶€ì ìœ¼ë¡œ ë˜ ë‹¤ë¥¸ ë™ì‹œì„± ê¸°ë³¸ ìš”ì†Œì¸ ì±„ë„ì„ ê´€ë¦¬í•´ì•¼ í•˜ê¸° ë•Œë¬¸ì— ìƒì„±í•˜ëŠ” ë° ì•½ê°„ ë¹„ìš©ì´ ë“ ë‹¤.
    - ì±„ë„ì€ ì½”ë£¨í‹´ ê°„ í†µì‹ ì„ ìœ„í•œ ë¹„êµì  ì €ìˆ˜ì¤€ì˜ ì¶”ìƒí™”
- í”Œë¡œìš° ì•ˆì—ì„œ ìƒˆë¡œìš´ ì½”ë£¨í‹´ì„ ì‹œì‘í•´ì•¼ í•˜ëŠ” ê²½ìš°ì—ë§Œ ì±„ë„ í”Œë¡œìš° ì„ íƒ

## ğŸ“– 16.3 í•« í”Œë¡œìš°

- í•« í”Œë¡œìš°ì—ì„œëŠ” ê° ìˆ˜ì§‘ìê°€ í”Œë¡œìš° ë¡œì§ ì‹¤í–‰ì„ ë…ë¦½ì ìœ¼ë¡œ ì´‰ë°œí•˜ëŠ” ëŒ€ì‹ , ì—¬ëŸ¬ êµ¬ë…ìë¼ê³  ë¶ˆë¦¬ëŠ” ìˆ˜ì§‘ìë“¤ì´ ë°°ì¶œëœ í•­ëª©ì„ ê³µìœ í•œë‹¤.
    - ê³µìœ  í”Œë¡œìš°: ê°’ì„ ë¸Œë¡œë“œìºìŠ¤íŠ¸í•˜ê¸° ìœ„í•´ ì‚¬ìš©
    - ìƒíƒœ í”Œë¡œìš°: ìƒíƒœë¥¼ ì „ë‹¬í•˜ëŠ” íŠ¹ë³„í•œ ê²½ìš°ì— ì‚¬ìš©

### ğŸ”– 16.3.1 ê³µìœ  í”Œë¡œìš°ëŠ” ê°’ì„ êµ¬ë…ìì—ê²Œ ë¸Œë¡œë“œìºìŠ¤íŠ¸í•œë‹¤

- ê³µìœ  í”Œë¡œìš°ëŠ” êµ¬ë…ìê°€ ì¡´ì¬í•˜ëŠ”ì§€ ì—¬ë¶€ì— ìƒê´€ì—†ì´ ë°°ì¶œì´ ë°œìƒí•˜ëŠ” ë¸Œë¡œë“œìºìŠ¤íŠ¸ ë°©ì‹

```kotlin
class RadioStation {
    private val _messageFlow = MutableSharedFlow<Int>()
    val messageFlow = _messageFlow.asSharedFlow()

    fun beginBroadcasting(scope: CoroutineScope) {
        scope.launch {
            while (true) {
                delay(500.milliseconds)
                val number = Random.nextInt(0..10)
                log("Emitting $number!")
                _messageFlow.emit(number)
            }
        }
    }
}
```

- í”Œë¡œìš° ë¹Œë”ë¥¼ ì‚¬ìš©í•˜ëŠ” ëŒ€ì‹  ê°€ë³€ì ì¸ í”Œë¡œìš°ì— ëŒ€í•œ ì°¸ì¡°ë¥¼ ì–»ëŠ”ë‹¤.
- ë°°ì¶œì´ êµ¬ë…ì ìœ ë¬´ì™€ ê´€ê³„ì—†ì´ ë°œìƒí•˜ë¯€ë¡œ ì—¬ëŸ¬ë¶„ì´ ì‹¤ì œ ë°°ì¶œì„ ìˆ˜í–‰í•˜ëŠ” ì½”ë£¨í‹´ì„ ì‹œì‘í•  ì±…ì„ì´ ìˆë‹¤.

```kotlin
fun main() = runBlocking {
    RadioStation().beginBroadcasting(this)
}
```

- êµ¬ë…ìê°€ ì—†ì–´ë„ ë¸Œë¡œë“œìºìŠ¤íŠ¸ê°€ ì¦‰ì‹œ ì‹œì‘

```kotlin
fun main() = runBlocking {
    val radioStation = RadioStation()
    radioStation.beginBroadcasting(this)
    delay(600.milliseconds)
    radioStation.messageFlow.collect {
        log("A collecting: $it!")
    }
}
```

- ì•½ê°„ì˜ ì§€ì—° í›„ì— ê³µìœ  í”Œë¡œìš° êµ¬ë…

#### ğŸ› ï¸ êµ¬ë…ìë¥¼ ìœ„í•œ ê°’ ì¬ìƒ

- ê³µìœ  í”Œë¡œìš° êµ¬ë…ìëŠ” êµ¬ë…ì„ ì‹œì‘í•œ ì´í›„ì— ë°°ì¶œëœ ê°’ë§Œ ìˆ˜ì‹ 

```kotlin
private val _messageFlow = MutableSharedFlow<Int>(replay = 5)
```

- ì´ì „ì— ë°°ì¶œëœ ì›ì†Œë„ ìˆ˜ì‹ í•˜ê¸°ë¥¼ ì›í•œë‹¤ë©´ `replay` íŒŒë¼ë¯¸í„° ì„¤ì •

#### ğŸ› ï¸ shareInìœ¼ë¡œ ì½œë“œ í”Œë¡œìš°ë¥¼ ê³µìœ  í”Œë¡œìš°ë¡œ ì „í™˜

```kotlin
fun querySensor(): Int = Random.nextInt(-10..30)

fun getTemperatures(): Flow<Int> {
    return flow {
        while (true) {
            emit(querySensor())
            delay(500.milliseconds)
        }
    }
}
```

- ì¼ì •í•œ ê°„ê²©ìœ¼ë¡œ ê°’ì„ ë°˜í™˜

```kotlin
fun celsiusToFahrenheit(celsius: Int) = celsius * 9.0 / 5.0 + 32.0

fun main() {
    val temps = getTemperatures()
    runBlocking {
        launch {
            temps.collect {
                log("$it Celsius")
            }
        }
        launch {
            temps.collect {
                log("${celsiusToFahrenheit(it)} Fahrenheit")
            }
        }
    }
}
```

- ì—¬ëŸ¬ë²ˆ í˜¸ì¶œí•˜ë ¤ë©´ ê° ìˆ˜ì§‘ìê°€ ì„¼ì„œì— ë…ë¦½ì ìœ¼ë¡œ ì§ˆì˜

```kotlin
fun main() {
    val temps = getTemperatures()
    runBlocking {
        val sharedTemps = temps.shareIn(this, SharingStarted.Lazily)
        launch {
            sharedTemps.collect {
                log("$it Celsius")
            }
        }
        launch {
            sharedTemps.collect {
                log("${celsiusToFahrenheit(it)} Fahrenheit")
            }
        }
    }
}
```

- `shareIn` í•¨ìˆ˜ë¥¼ ì‚¬ìš©í•˜ë©´ ì£¼ì–´ì§„ ì½œë“œ í”Œë¡œìš°ë¥¼ í•œ í”Œë¡œìš°ì¸ ê³µìœ  í”Œë¡œìš°ë¡œ ë³€í™˜í•  ìˆ˜ ìˆë‹¤.
- ë‘ë²ˆì§¸ íŒŒë¼ë¯¸í„° `started`ëŠ” í”Œë¡œìš°ê°€ ì‹¤ì œë¡œ ì–¸ì œ ì‹œì‘ë¼ì•¼ í•˜ëŠ”ì§€ë¥¼ ì •ì˜
    - `Eagerly`ëŠ” í”Œë¡œìš° ìˆ˜ì§‘ì„ ì¦‰ì‹œ ì‹œì‘
    - `Lazily`ëŠ” ì²« ë²ˆì§¸ êµ¬ë…ìê°€ ë‚˜íƒ€ë‚˜ì•¼ë§Œ ìˆ˜ì§‘ ì‹œì‘
    - `WhileSubscribed`ëŠ” ì²« ë²ˆì§¸ êµ¬ë…ìê°€ ë‚˜íƒ€ë‚˜ì•¼ ìˆ˜ì§‘ì„ ì‹œì‘í•˜ê³ , ë§ˆì§€ë§‰ êµ¬ë…ìê°€ ì‚¬ë¼ì§€ë©´ í”Œë¡œìš° ìˆ˜ì§‘ì„ ì·¨ì†Œ
- ì½”í‹€ë¦°ì—ì„œëŠ” ì‹œê°„ì´ ì§€ë‚¨ì— ë”°ë¼ ì—¬ëŸ¬ ê°’ì„ ê³„ì‚°í•˜ëŠ” ì‘ì—…ì„ ë‹¨ìˆœí•œ ì½œë“œ í”Œë¡œìš°ë¡œ ë…¸ì¶œí•˜ê³ , í•„ìš”í•  ë•Œ ì½œë“œ í”Œë¡œìš°ë¥¼ í•« í”Œë¡œìš°ë¡œ ë³€í™˜í•˜ëŠ” íŒ¨í„´ì´ ìì£¼ ì‚¬ìš©ëœë‹¤.

### ğŸ”– 16.3.2 ì‹œìŠ¤í…œ ìƒíƒœ ì¶”ì : ìƒíƒœ í”Œë¡œìš°

```kotlin
class ViewCounter {
    private val _counter = MutableStateFlow(0)
    val counter = _counter.asStateFlow()
    fun increment() {
        _counter.update { it + 1 }
    }
}

fun main() {
    val vc = ViewCounter()
    vc.increment()
    println(vc.counter.value)
}
```

- ê°’ì„ ë°°ì¶œí•˜ëŠ” `emit`ì„ ì‚¬ìš©í•˜ëŠ” ëŒ€ì‹ , ê°’ì„ ê°±ì‹ í•˜ëŠ” `update` í•¨ìˆ˜ ì‚¬ìš©

#### ğŸ› ï¸ UPDATE í•¨ìˆ˜ë¡œ ì•ˆì „í•˜ê²Œ ìƒíƒœ í”Œë¡œìš°ì— ì“°ê¸°

```kotlin
    fun increment() {
    _counter.value++
}
```

- `value` ëŠ” ê°€ë³€ ì†ì„±ì´ë‹ˆê¹Œ ìœ„ì™€ ê°™ì´ êµ¬í˜„í•´ë„ ë ê¹Œ?
- ìœ„ ì—°ì‚°ì€ ì›ìì ì´ì§€ ì•Šë‹¤.
- ì¦‰, ì½”ë£¨í‹´ë“¤ì´ ì—¬ëŸ¬ ìŠ¤ë ˆë“œì—ì„œ ì‹¤í–‰ë˜ê¸° ë•Œë¬¸ì— ë¬¸ì œê°€ ìˆë‹¤.
    - ì–´ëŠ í•œìª½ì˜ ì¦ê°€ ì—°ì‚°ì´ ë¬´íš¨í™”

#### ğŸ› ï¸ ìƒíƒœ í”Œë¡œìš°ëŠ” ê°’ì´ ì‹¤ì œë¡œ ë‹¬ë¼ì¡Œì„ ë•Œë§Œ ê°’ì„ ë°°ì¶œí•œë‹¤: ë™ë“±ì„± ê¸°ë°˜ í†µí•©

```kotlin
enum class Direction { LEFT, RIGHT }

class DirectionSelector {
    private val _direction = MutableStateFlow(Direction.LEFT)
    val direction = _direction.asStateFlow()

    fun turn(d: Direction) {
        _direction.update { d }
    }
}

fun main() = runBlocking {
    val switch = DirectionSelector()
    launch {
        switch.direction.collect {
            log("Direction now $it")
        }
    }
    delay(200.milliseconds)
    switch.turn(Direction.RIGHT)
    delay(200.milliseconds)
    switch.turn(Direction.LEFT)
    delay(200.milliseconds)
    switch.turn(Direction.LEFT)
}
```

```text
0 [main @coroutine#2] Direction now LEFT
210 [main @coroutine#2] Direction now RIGHT
405 [main @coroutine#2] Direction now LEFT
```

- LEFT ì¸ìê°€ í•œë²ˆë§Œ í˜¸ì¶œì´ ëœë‹¤.
- ìƒíƒœ í”Œë¡œìš°ê°€ ë™ë“±ì„± ê¸°ë°˜ í†µí•©ì„ ìˆ˜í–‰í•˜ê¸° ë•Œë¬¸
    - ê°’ì´ ì‹¤ì œë¡œ ë‹¬ë¼ì¡Œì„ ë•Œë§Œ êµ¬ë…ìì—ê²Œ ê°’ì„ ë°°ì¶œ

#### ğŸ› ï¸ stateIn ìœ¼ë¡œ ì½œë“œ í”Œë¡œìš°ë¥¼ ìƒíƒœ í”Œë¡œìš°ë¡œ ë³€í™˜í•˜ê¸°

```kotlin
fun main() = runBlocking {
    val temps = getTemperatures()

    runBlocking {
        val tempState = temps.stateIn(this)
        println(tempState.value)
        delay(800.milliseconds)
        println(tempState.value)
    }
}
```

- `stateIn`ìœ¼ë¡œ ì½œë“œ í”Œë¡œìš°ë¥¼ ìƒíƒœ í”Œë¡œìš°ë¡œ ë³€í™˜í•  ìˆ˜ ìˆë‹¤.
- ì›ë˜ í”Œë¡œìš°ì—ì„œ ë°°ì¶œëœ ìµœì‹  ê°’ì„ í•­ìƒ ì½ì„ ìˆ˜ ìˆë‹¤.

### ğŸ”– 16.3.3 ìƒíƒœ í”Œë¡œìš°ì™€ ê³µìœ  í”Œë¡œìš°ì˜ ë¹„êµ

- ì¼ë°˜ì ìœ¼ë¡œ ìƒíƒœ í”Œë¡œìš°ëŠ” ê³µìœ  í”Œë¡œìš°ë³´ë‹¤ ë” ê°„ë‹¨í•œ APIë¥¼ ì œê³µ

```kotlin
class Broadcaster {
    private val _messages = MutableSharedFlow<String>()
    val messages = _messages.asSharedFlow()
    fun beginBroadcasting(scope: CoroutineScope) {
        scope.launch {
            _messages.emit("Hello!")
            _messages.emit("Hi!")
            _messages.emit("Hola!")
        }
    }
}

fun main(): Unit = runBlocking {
    val broadcaster = Broadcaster()
    broadcaster.beginBroadcasting(this)
    delay(200.milliseconds)
    broadcaster.messages.collect {
        println("Message: $it")
    }
}
```

- ì²« ë²ˆì§¸ êµ¬ë…ìê°€ ë‚˜íƒ€ë‚˜ê¸° ì „ì— ëª¨ë“  ë©”ì‹œì§€ë¥¼ ë°°ì¶œí•˜ëŠ” ë¸Œë¡œë“œìºìŠ¤íŠ¸
- ë©”ì‹œì§€ë¥¼ ì¶œë ¥í•˜ì§€ ì•ŠìŒ.

```kotlin
class Broadcaster {
    private val _messages = MutableStateFlow<List<String>>(emptyList())
    val messages = _messages.asStateFlow()
    fun beginBroadcasting(scope: CoroutineScope) {
        scope.launch {
            _messages.update { it + "Hello!" }
            _messages.update { it + "Hi!" }
            _messages.update { it + "Hola!" }
        }
    }
}

fun main() = runBlocking {
    val broadcaster = Broadcaster()
    broadcaster.beginBroadcasting(this)
    delay(200.milliseconds)
    println(broadcaster.messages.value)
}
```

- ìƒíƒœ í”Œë¡œìš°ëŠ” ì „ì²´ ë©”ì‹œì§€ ê¸°ë¡ì„ ë¦¬ìŠ¤íŠ¸ë¡œ ì €ì¥í•˜ë©´ì„œ êµ¬ë…ìê°€ ëª¨ë“  ì´ì „ ë©”ì‹œì§€ì— ì‰½ê²Œ ì ‘ê·¼í•  ìˆ˜ ìˆê²Œ í•  ìˆ˜ ìˆë‹¤.

### ğŸ”– 16.3.4 í•« í”Œë¡œìš°, ì½œë“œ í”Œë¡œìš°, ê³µìœ  í”Œë¡œìš°, ìƒíƒœ í”Œë¡œìš°: ì–¸ì œ ì–´ë–¤ í”Œë¡œìš°ë¥¼ ì‚¬ìš©í• ê¹Œ?

### í‘œ 16.1 ì½œë“œ í”Œë¡œìš°ì™€ í•« í”Œë¡œìš° ë¹„êµ

| ì½œë“œ í”Œë¡œìš°                               | í•« í”Œë¡œìš°                  |
|--------------------------------------|------------------------|
| ê¸°ë³¸ì ìœ¼ë¡œ ë¹„í™œì„±(ìˆ˜ì§‘ìì— ì˜í•´ í™œì„±í™”ë¨)              | ê¸°ë³¸ì ìœ¼ë¡œ í™œì„±í™”ë¨             |
| ìˆ˜ì§‘ìê°€ í•˜ë‚˜ ìˆìŒ                           | ì—¬ëŸ¬ êµ¬ë…ìê°€ ìˆìŒ             |
| ìˆ˜ì§‘ìëŠ” ëª¨ë“  ë°°ì¶œì„ ë°›ìŒ                       | êµ¬ë…ìëŠ” êµ¬ë… ì‹œì‘ ì‹œì ë¶€í„° ë°°ì¶œì„ ë°›ìŒ |
| ë³´í†µì€ ì™„ë£Œë¨                              | ì™„ë£Œë˜ì§€ ì•ŠìŒ                |
| í•˜ë‚˜ì˜ ì½”ë£¨í‹´ì—ì„œ ë°°ì¶œ ë°œìƒ(channelFlow ì‚¬ìš© ì‹œ ì˜ˆì™¸) | ì—¬ëŸ¬ ì½”ë£¨í‹´ì—ì„œ ë°°ì¶œí•  ìˆ˜ ìˆìŒ      |
